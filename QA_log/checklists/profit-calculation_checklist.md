# ✅ 수익률 계산 기능 QA 체크리스트

## 📋 기본 정보
- **작성자**: [이름]
- **작성일**: [YYYY-MM-DD]
- **기능**: 수익률 계산 엔진 (개별 종목 및 전체 포트폴리오)
- **테스트 환경**: [ ] 로컬 / [ ] 스테이징 / [ ] 프로덕션
- **관련 이슈**: #[번호]

---

## 🎯 기능 요구사항 확인

### 개별 종목 수익률
- [ ] 단순 수익률 계산 (현재가 - 매수가)
- [ ] 수익률 퍼센티지 계산 ((현재가 - 매수가) / 매수가 × 100)
- [ ] 평가 금액 계산 (현재가 × 보유 수량)
- [ ] 투자 금액 계산 (평균 매수가 × 보유 수량)
- [ ] 수익/손실 금액 계산 (평가 금액 - 투자 금액)

### 분할 매수 처리
- [ ] 여러 번 매수한 경우 평균 단가 계산
- [ ] 각 거래의 가중 평균 계산
- [ ] 거래 수수료 포함 옵션
- [ ] 세금 포함 옵션 (증권거래세 등)

### 해외 주식 환율 처리
- [ ] 달러 기준 수익률 계산
- [ ] 원화 환산 수익률 계산
- [ ] 환차손익 별도 표시
- [ ] 매수 시점 환율과 현재 환율 비교
- [ ] 환율 변동에 따른 손익 분석

### 전체 포트폴리오 수익률
- [ ] 모든 종목의 수익/손실 합계
- [ ] 전체 투자 금액 대비 수익률
- [ ] 실현 손익 (매도 완료)
- [ ] 미실현 손익 (보유 중)
- [ ] 일간/주간/월간/연간 수익률

### 배당 수익 포함
- [ ] 받은 배당금 총액
- [ ] 배당 수익률 (배당금 / 투자 금액)
- [ ] 배당 재투자 시 복리 수익률
- [ ] 세금 공제 후 실수령액

---

## 🧪 기능 테스트

### 기본 계산 테스트

#### 테스트 1: 단일 매수 수익
- **조건**: 삼성전자 10주를 70,000원에 매수, 현재가 73,500원
- **기대 결과**:
  - [ ] 투자 금액: 700,000원
  - [ ] 평가 금액: 735,000원
  - [ ] 수익 금액: 35,000원
  - [ ] 수익률: 5.0%

#### 테스트 2: 단일 매수 손실
- **조건**: 테슬라 5주를 $250에 매수, 현재가 $230
- **기대 결과**:
  - [ ] 투자 금액: $1,250
  - [ ] 평가 금액: $1,150
  - [ ] 손실 금액: -$100
  - [ ] 손실률: -8.0%

#### 테스트 3: 분할 매수 평균 단가
- **조건**: 
  - 1차 매수: 애플 10주 @ $180
  - 2차 매수: 애플 5주 @ $190
  - 현재가: $195
- **기대 결과**:
  - [ ] 평균 매수가: $183.33 (= (180×10 + 190×5) / 15)
  - [ ] 투자 금액: $2,750
  - [ ] 평가 금액: $2,925 (= 195 × 15)
  - [ ] 수익 금액: $175
  - [ ] 수익률: 6.36%

#### 테스트 4: 수수료 포함 계산
- **조건**: 
  - 삼성전자 10주 @ 70,000원
  - 매수 수수료: 2,000원
  - 현재가: 73,500원
- **기대 결과**:
  - [ ] 실제 투자 금액: 702,000원 (700,000 + 2,000)
  - [ ] 평가 금액: 735,000원
  - [ ] 수익 금액: 33,000원
  - [ ] 수익률: 4.70%

#### 테스트 5: 환율 포함 계산 (해외 주식)
- **조건**:
  - 애플 10주 @ $180
  - 매수 시 환율: 1,300원/$
  - 현재가: $195
  - 현재 환율: 1,320원/$
- **기대 결과**:
  - [ ] 달러 기준 수익률: 8.33% (= (195-180)/180 × 100)
  - [ ] 원화 투자 금액: 2,340,000원 (= 180 × 10 × 1,300)
  - [ ] 원화 평가 금액: 2,574,000원 (= 195 × 10 × 1,320)
  - [ ] 원화 수익 금액: 234,000원
  - [ ] 원화 수익률: 10.0%
  - [ ] 환차익: 39,000원 (= 195 × 10 × (1,320-1,300))

### 엣지 케이스

#### 테스트 6: 소수점 처리
- **조건**: QQQ 3.5주 @ $380.456, 현재가 $395.123
- **기대 결과**:
  - [ ] 소수점 4자리까지 정확히 계산
  - [ ] 반올림 오차 최소화
  - [ ] 표시는 소수점 2자리

#### 테스트 7: 0원 또는 0주
- **조건**: 비정상 데이터 (수량 0, 가격 0)
- **기대 결과**:
  - [ ] Division by zero 에러 방지
  - [ ] 기본값 0% 또는 에러 메시지

#### 테스트 8: 음수 입력
- **조건**: 잘못된 입력 (음수 수량, 음수 가격)
- **기대 결과**:
  - [ ] 입력 검증으로 음수 방지
  - [ ] 에러 메시지 표시

#### 테스트 9: 매우 큰 숫자
- **조건**: 100만 주, 주당 $10,000
- **기대 결과**:
  - [ ] 오버플로우 없이 정확히 계산
  - [ ] 천 단위 콤마로 가독성 확보

#### 테스트 10: 환율 0 또는 null
- **조건**: 환율 API 실패로 환율 정보 없음
- **기대 결과**:
  - [ ] 마지막 알려진 환율 사용
  - [ ] 또는 경고 메시지와 함께 달러 기준만 표시

---

## 📊 복합 시나리오 테스트

### 시나리오 1: 다양한 종목 포트폴리오
- **조건**:
  - 삼성전자: 10주 @ 70,000원, 현재가 73,500원
  - 애플: 5주 @ $180, 현재가 $190 (환율 1,300→1,320)
  - SCHD: 3주 @ $80, 현재가 $82 (환율 동일)
- **기대 결과**:
  - [ ] 각 종목별 수익률 정확
  - [ ] 전체 포트폴리오 수익률 정확
  - [ ] 원화 환산 총액 정확
  - [ ] 비중 계산 정확 (각 종목이 전체에서 차지하는 비율)

### 시나리오 2: 일부 종목 매도 후
- **조건**:
  - 테슬라 10주 보유
  - 5주 매도 (일부 매도)
- **기대 결과**:
  - [ ] 남은 5주에 대해서만 수익률 계산
  - [ ] 실현 손익에 매도한 5주 반영
  - [ ] 미실현 손익에 보유 중인 5주 반영

### 시나리오 3: 배당 재투자
- **조건**:
  - SCHD 10주 @ $80 보유
  - 배당금 $100 받아서 1.25주 추가 매수 @ $80
- **기대 결과**:
  - [ ] 총 보유 수량: 11.25주
  - [ ] 배당 재투자 금액 투자 금액에 포함
  - [ ] 배당 수익률 별도 계산

---

## 🎯 정확도 테스트

### 계산 정확도
- [ ] 소수점 6자리까지 내부 계산
- [ ] 표시는 소수점 2자리로 반올림
- [ ] 여러 번 계산해도 동일한 결과
- [ ] 금융 계산 라이브러리 사용 (부동소수점 오차 방지)

### 실시간 업데이트
- [ ] 가격 변동 시 즉시 수익률 재계산
- [ ] 환율 변동 시 즉시 재계산
- [ ] 로컬 캐시와 서버 데이터 동기화
- [ ] 계산 로직 변경 시 모든 데이터 재계산

### 역산 검증
- [ ] 평가금액 = 현재가 × 수량 검증
- [ ] 투자금액 = 평균 매수가 × 수량 검증
- [ ] 수익률 = (평가금액 - 투자금액) / 투자금액 × 100 검증
- [ ] 원화 환산 = 달러 금액 × 환율 검증

---

## 🔍 UI 표시 테스트

### 수익률 표시
- [ ] 양수(수익)는 초록색, 음수(손실)은 빨간색
- [ ] 플러스/마이너스 기호 명확히 표시 (+5.0%, -3.2%)
- [ ] 금액 천 단위 콤마 (예: 1,234,567원)
- [ ] 퍼센티지 소수점 2자리 (예: 12.34%)

### 툴팁 및 상세 정보
- [ ] 수익률 호버 시 계산 방식 표시
- [ ] 평균 매수가 클릭 시 거래 이력 표시
- [ ] 환율 호버 시 현재 환율 정보 표시
- [ ] 수수료/세금 포함 여부 표시

### 애니메이션
- [ ] 수익률 변경 시 부드러운 전환 효과
- [ ] 양수↔음수 전환 시 색상 애니메이션
- [ ] 급등/급락 시 하이라이트 효과

---

## 🔌 통합 테스트

### 데이터 소스 연동
- [ ] Firebase에서 거래 이력 조회
- [ ] 실시간 주가 API 연동 (Alpha Vantage, KIS API)
- [ ] 환율 API 연동 (ExchangeRate-API)
- [ ] 배당 정보 API 연동

### 계산 엔진
- [ ] 백엔드 또는 클라이언트 사이드 계산
- [ ] 계산 결과 캐싱 (5분)
- [ ] 병렬 계산 (여러 종목 동시 처리)
- [ ] 에러 발생 시 fallback 계산

### 다른 기능과의 연동
- [ ] 포트폴리오 대시보드에 수익률 표시
- [ ] AI 분석에 수익률 데이터 제공
- [ ] 알림에 수익률 임계값 사용
- [ ] 리포트에 수익률 히스토리 포함

---

## 🔐 보안 & 성능

### 성능
- [ ] 100개 종목 수익률 계산 < 100ms
- [ ] 실시간 업데이트 시 CPU 사용률 < 10%
- [ ] 메모리 누수 없음
- [ ] 모바일에서도 빠른 계산

### 정확성 보장
- [ ] 단위 테스트로 모든 케이스 검증
- [ ] 알려진 결과와 비교 검증
- [ ] 회계 감사 가능한 계산 로직
- [ ] 계산 과정 로깅 (디버깅용)

---

## 📊 테스트 결과 요약

### 단위 테스트 결과
| 테스트 케이스 | 예상 결과 | 실제 결과 | 통과 |
|--------------|----------|----------|------|
| 단일 매수 수익 | 5.0% | | ✅/❌ |
| 단일 매수 손실 | -8.0% | | ✅/❌ |
| 분할 매수 | 6.36% | | ✅/❌ |
| 수수료 포함 | 4.70% | | ✅/❌ |
| 환율 포함 | 10.0% | | ✅/❌ |

### 정확도 검증
- [ ] 계산 오차 < 0.01%
- [ ] 반올림 오차 최소화
- [ ] 극단적 케이스에서도 정확

### 성능 측정
| 지표 | 목표 | 실제 | 통과 |
|------|------|------|------|
| 계산 시간 (100종목) | < 100ms | | ✅/❌ |
| CPU 사용률 | < 10% | | ✅/❌ |
| 메모리 사용 | < 50MB | | ✅/❌ |

### 발견된 이슈
| 이슈 | 심각도 | 재현율 | 상태 |
|------|--------|--------|------|
|      | 🔴/🟡/🔵 | %  | 🆕/🔄/✅ |

---

## ✅ 최종 승인

### 계산 로직 검증
- [ ] 금융 전문가 검토 완료
- [ ] 회계 기준 준수 확인
- [ ] 세금 처리 방식 검증
- [ ] 엣지 케이스 모두 처리

### 성능 & 안정성
- [ ] 부하 테스트 통과
- [ ] 메모리 누수 없음
- [ ] 크로스 브라우저 테스트 완료
- [ ] 모바일 최적화 완료

### 문서화
- [ ] 계산 공식 문서화
- [ ] API 문서화
- [ ] 사용자 가이드 작성
- [ ] 개발자 문서 작성

### 승인
- [ ] QA 담당자 승인
- [ ] 재무 담당자 승인 (계산 로직)
- [ ] 개발 팀 리더 승인
- [ ] 프로덕트 매니저 승인

---

## 📝 추가 노트

### 계산 공식 정리
```
# 기본 수익률
수익률(%) = ((현재가 - 평균매수가) / 평균매수가) × 100

# 평균 매수가
평균매수가 = Σ(매수가 × 수량) / Σ(수량)

# 원화 환산 (해외 주식)
원화 수익률(%) = ((현재가×현재환율 - 매수가×매수환율) / (매수가×매수환율)) × 100

# 전체 포트폴리오 수익률
포트폴리오 수익률(%) = (Σ평가금액 - Σ투자금액) / Σ투자금액 × 100
```

### 참고 자료
- [금융 계산 표준](링크)
- [세금 계산 방식](링크)
- [환율 처리 가이드](링크)

---

## 🎯 향후 개선 아이디어

- [ ] 시간 가중 수익률 (TWR) 계산
- [ ] 화폐 가중 수익률 (MWR) 계산
- [ ] 샤프 비율, 소르티노 비율 등 위험 조정 수익률
- [ ] 벤치마크 대비 초과 수익률 (알파)
- [ ] 세후 수익률 계산
- [ ] 인플레이션 조정 수익률
